standard:
  directories:
    - "**/.js"
    - "!test/integration/packages/**/*.js"
suites:
  unit: 
    - name: unit
      test:
        specs: test/unit
      coverage:
        config:
          dir: .coverage/unit
  integration:
    - name: no-config
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: sum
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: sum
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/report.specs.js
          - test/integration/specs/coverage/json.specs.js
          - test/integration/specs/coverage/lcov.specs.js
          - test/integration/specs/coverage/summary.specs.js
          - test/integration/specs/exit/exit-ok.specs.js
        local:
          wait-on: .narval/logs/integration/no-config/package-test/exit-code.log
          env:
            package_to_launch: sum
            coverage_dir: .coverage
      coverage:
        enabled: false
    - name: standard-ko
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: standard-ko
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: standard-ko
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ko.specs.js
          - test/integration/specs/tests/unit-not-launched.specs.js
          - test/integration/specs/exit/exit-ko.specs.js
        local:
          wait-on: .narval/logs/integration/standard-ko/package-test/exit-code.log
          env:
            package_to_launch: standard-ko
      coverage:
        enabled: false
    - name: standard-dirs
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: standard-ko
            narval_config: standard-dirs
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: standard-ko
              narval_options: -- --standard
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/exit/exit-ok.specs.js
        local:
          wait-on: .narval/logs/integration/standard-dirs/package-test/exit-code.log
          env:
            package_to_launch: standard-ko
      coverage:
        enabled: false
    - name: standard-dirs-array
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: standard-ko
            narval_config: standard-dirs-array
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: standard-ko
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/exit/exit-ko.specs.js # Should end ko because have no tests
        local:
          wait-on: .narval/logs/integration/standard-dirs-array/package-test/exit-code.log
          env:
            package_to_launch: standard-ko
      coverage:
        enabled: false
    - name: test-ko
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: sum
            narval_config: test-ko
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: sum
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/test-ko.specs.js
          - test/integration/specs/coverage/json.specs.js
          - test/integration/specs/coverage/lcov.specs.js
          - test/integration/specs/coverage/summary.specs.js
          - test/integration/specs/exit/exit-ko.specs.js
        local:
          wait-on: .narval/logs/integration/test-ko/package-test/exit-code.log
          env:
            package_to_launch: sum
            coverage_dir: .coverage
      coverage:
        enabled: false
    - name: tests-config
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: sum
            narval_config: tests-config
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: sum
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/coverage/json.specs.js
          - test/integration/specs/coverage/details.specs.js
          - test/integration/specs/tests-config
          - test/integration/specs/exit/exit-ok.specs.js
        local:
          wait-on: .narval/logs/integration/tests-config/package-test/exit-code.log
          env:
            package_to_launch: sum
            coverage_dir: .coverage/custom
      coverage:
        enabled: false
    - name: coverage-disabled
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: sum
            narval_config: coverage-disabled
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: sum
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/coverage/disabled.specs.js
          - test/integration/specs/coverage-disabled
          - test/integration/specs/exit/exit-ok.specs.js
        local:
          wait-on: .narval/logs/integration/coverage-disabled/package-test/exit-code.log
          env:
            package_to_launch: sum
            coverage_dir: .coverage/unit
      coverage:
        enabled: false
    - name: api-docker
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: api
            narval_config: api
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: api
              narval_options: -- --build
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/coverage/json.specs.js
          - test/integration/specs/coverage/lcov.specs.js
          - test/integration/specs/coverage/summary.specs.js
          - test/integration/specs/docker/run.specs.js
          - test/integration/specs/docker/build.specs.js
          - test/integration/specs/docker/down-volumes.specs.js
          - test/integration/specs/docker/shared.specs.js
          - test/integration/specs/api-docker
          - test/integration/specs/exit/exit-ok.specs.js
          - test/integration/specs/environment/defaults.specs.js
        local:
          wait-on:
            resources: 
              - .narval/logs/integration/api-docker/package-test/exit-code.log
            timeout: 600000
          env:
            package_to_launch: api
            coverage_dir: .coverage/unit
      coverage:
        enabled: false
    - name: api-docker-no-build
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: api
            narval_config: api
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: api
      test:
        specs:
          - test/integration/specs/standard/standard-run.specs.js
          - test/integration/specs/standard/standard-ok.specs.js
          - test/integration/specs/tests/test-launch.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/coverage/json.specs.js
          - test/integration/specs/coverage/lcov.specs.js
          - test/integration/specs/coverage/summary.specs.js
          - test/integration/specs/docker/run.specs.js
          - test/integration/specs/docker/not-build.specs.js
          - test/integration/specs/docker/down-volumes.specs.js
          - test/integration/specs/docker/shared.specs.js
          - test/integration/specs/api-docker
          - test/integration/specs/exit/exit-ok.specs.js
          - test/integration/specs/environment/defaults.specs.js
        local:
          wait-on:
            resources: 
              - .narval/logs/integration/api-docker-no-build/package-test/exit-code.log
            timeout: 600000
          env:
            package_to_launch: api
            coverage_dir: .coverage/unit
      coverage:
        enabled: false
    - name: api-docker-no-down-volumes
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: api
            narval_config: api-no-down-volumes
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: api
              narval_options: -- --suite=books-api
      test:
        specs:
          - test/integration/specs/standard/standard-not-run.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/tests/unit-not-launched.specs.js
          - test/integration/specs/docker/run.specs.js
          - test/integration/specs/docker/not-build.specs.js
          - test/integration/specs/docker/not-down-volumes.specs.js
          - test/integration/specs/docker/shared.specs.js
          - test/integration/specs/api-docker
          - test/integration/specs/exit/exit-ok.specs.js
          - test/integration/specs/environment/defaults.specs.js
          - test/integration/specs/environment/custom-no-down-volumes.specs.js
          - test/integration/specs/logs/service.logs.specs.js
        local:
          wait-on:
            resources: 
              - .narval/logs/integration/api-docker-no-down-volumes/package-test/exit-code.log
            timeout: 600000
          env:
            package_to_launch: api
      coverage:
        enabled: false
    - name: api-integration
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: api
            narval_config: api-integration
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: api
              narval_options: -- --type=integration
      test:
        specs:
          - test/integration/specs/standard/standard-not-run.specs.js
          - test/integration/specs/tests/test-ok.specs.js
          - test/integration/specs/tests/unit-not-launched.specs.js
          - test/integration/specs/docker/run.specs.js
          - test/integration/specs/docker/not-build.specs.js
          - test/integration/specs/docker/not-down-volumes.specs.js
          - test/integration/specs/docker/shared.specs.js
          - test/integration/specs/api-integration
          - test/integration/specs/exit/exit-ok.specs.js
        local:
          wait-on:
            resources: 
              - .narval/logs/integration/api-integration/package-test/exit-code.log
            timeout: 600000
          env:
            package_to_launch: api
      coverage:
        enabled: false
    - name: api-integration-abort-on-error
      before:
        local:
          command: test/integration/commands/prepare-package.sh
          env:
            package_to_launch: api
            narval_config: api-integration-abort-on-error
      services:
        - name: package-test
          local:
            command: test/integration/commands/launch-test.sh
            env:
              package_to_launch: api
      test:
        specs:
          - test/integration/specs/docker/not-build.specs.js
          - test/integration/specs/docker/not-down-volumes.specs.js
          - test/integration/specs/docker/shared.specs.js
          - test/integration/specs/exit/exit-ko.specs.js
          - test/integration/specs/api-abort-on-error
        local:
          wait-on:
            resources: 
              - .narval/logs/integration/api-integration-abort-on-error/package-test/exit-code.log
            timeout: 600000
          env:
            package_to_launch: api
      coverage:
        enabled: false
