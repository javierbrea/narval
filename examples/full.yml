docker-images:
  - name: basic-image
    from: javierbrea/node-headless-chrome:1.0.0
    add:
      - package.json
      - npm-shrinkwrap.json
    expose:
      - 3000
    install: test/docker/install
docker-services:
  - name: service
    build: basic-image
    bind:
      - lib
      - test
      - node_modules
      - index.js
  - name: test
    build: basic-image
    bind:
      - lib
      - test
      - node_modules
      - index.js
    depends_on:
      - service
suites:
  unit: 
    - name: unit
      test:
        specs: test/unit
        config:
          reporter: dot
  integration:
    - name: built-in-api
      services:
        - docker-service: service
          exit_after: 20000
          commands:
#            local: test/integration/built-in-api/basic-service/start-local
            docker: test/services/app/start.js --name=service --path=/app/.shared --host=service
      test: 
        docker-service: test
        wait-for: service:3000
        specs: test/integration/built-in-api
        config:
          reporter: dot
      coverage:
        from: service
        config:
          root: .
          x: "**/*.js"
          i: index.js
          default-excludes: false
          report: text
          dir: .coverage/custom
          print: none
          verbose: true
          preserve-comments: true
          include-all-sources: false
    - name: tracer
      docker-compose-down: true
      services:
        - docker-service: service
          commands:
  #         local: test/integration/built-in-api/basic-service/start-local
            docker: test/services/commands/docker/log-level-warn
      test: 
        docker-service: test
        wait-for: service:3000
        specs: test/integration/tracer
        config:
          reporter: progress
      coverage:
        enabled: false
  end-to-end:
    - name: web-ui
      services:
        - docker-service: service
          commands:
#           local: test/end-to-end/web-ui/basic-service/start-local
            docker: test/services/commands/docker/basic-start
      test: 
        docker-service: test
        wait-for: service:3000
        specs: test/end-to-end/web-ui
        config:
          reporter: progress
